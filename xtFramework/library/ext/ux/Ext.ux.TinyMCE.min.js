(function(){Ext.namespace("Ext.ux");var C=false;Ext.ux.TinyMCE=Ext.extend(function(D){var E={tinymceSettings:{accessibility_focus:false}};Ext.apply(E,D);this.addEvents({"editorcreated":true});Ext.ux.TinyMCE.superclass.constructor.call(this,E)},Ext.form.Field,{tinymceSettings:null,defaultAutoCreate:{tag:"div",style:{overflow:"hidden"},children:[{tag:"textarea"}]},width:200,height:200,initComponent:function(){this.tinymceSettings=this.tinymceSettings||{};Ext.ux.TinyMCE.initTinyMCE({language:this.tinymceSettings.language})},onRender:function(G,D){Ext.ux.TinyMCE.superclass.onRender.call(this,G,D);var F=this;var H=this.getEl();if(Ext.type(this.width)=="number"){H.setWidth(this.width);this.tinymceSettings.width=this.width}if(Ext.type(this.height)=="number"){H.setHeight(this.height);this.tinymceSettings.height=this.height}var E=H.child("textarea");this.textareaEl=E;if(this.name){E.set({name:this.name})}var I=E.id;this.ed=new tinymce.Editor(I,this.tinymceSettings);this.ed.onBeforeRenderUI.add(function(K,J){K.controlManager=new A(this,K)}.createDelegate(this));this.ed.onInit.add(function(){var K=Ext.get(Ext.DomQuery.selectNode("#"+this.ed.id+"_tbl td.mceToolbar"));var J=K.select("> table.mceToolbar");Ext.DomHelper.append(K,{tag:"div",style:{overflow:"hidden"}},true).appendChild(J)}.createDelegate(this));this.ed.onActivate.add(this.focus.createDelegate(this,[false,false],false));this.ed.render();tinyMCE.add(this.ed);this.ed.windowManager=new B(this.ed);this.fireEvent("editorcreated")},getName:function(){return this.rendered&&this.textareaEl.dom.name?this.textareaEl.dom.name:(this.name||"")},initValue:function(){if(this.value!==undefined){this.setValue(this.value)}else{var D=this.getEl().child("textarea",true);if(D.value.length>0){this.setValue(D.value)}}},getValue:function(){if(!this.rendered||!this.ed.initialized){return this.value}var D=this.ed.getContent();if(D===this.emptyText||D===undefined){D=""}return D},setValue:function(D){this.value=D;if(this.rendered){this.withEd(function(){this.ed.undoManager.clear();this.ed.setContent(D===null||D===undefined?"":D);this.validate()})}},syncValue:function(){if(this.rendered&&this.ed.initialized){this.ed.save()}},getEd:function(){return this.ed},onResize:function(E,D){if(this.rendered){this.withEd(function(){if(Ext.type(E)!="number"){E=this.el.getWidth()}if(Ext.type(D)!="number"){D=this.el.getHeight()}Ext.fly(this.ed.id+"_parent").setSize(E,D);var G=Ext.get(this.ed.id+"_tbl");G.setSize(E-2,D-2);var I=G.select("td.mceToolbar > div").first();var H=5;if(I){H+=I.getHeight()+2;I.setWidth(E-2)}var F=G.select("td.mceStatusbar > div").first().first();if(F){H+=F.getHeight()+5;F.setWidth(E-2)}G.select("td.mceIframeContainer > iframe").first().setHeight(D-H)})}},focus:function(E,D){Ext.ux.TinyMCE.superclass.focus.call(this,E,D)},onFocus:function(){if(!this.hasFocus){this.hasFocus=true;this.startValue=this.getValue();this.withEd(function(){this.ed.focus();this.fireEvent("focus",this)})}},withEd:function(D){if(!this.ed){this.on("editorcreated",function(){this.withEd(D)},this)}else{if(this.ed.initialized){D.call(this)}else{this.ed.onInit.add(function(){D.defer(10,this)}.createDelegate(this))}}}});Ext.apply(Ext.ux.TinyMCE,{tinymcePlugins:"safari,pagebreak,style,layer,table,advhr,advimage,advlink,emotions,iespell,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,noneditable,visualchars,nonbreaking,xhtmlxtras,template",initTinyMCE:function(E){if(!C){var D={mode:"none",plugins:Ext.ux.TinyMCE.tinymcePlugins,theme:"advanced"};Ext.apply(D,E);tinyMCE.init(D);C=true}}});Ext.ComponentMgr.registerType("tinymce",Ext.ux.TinyMCE);var B=Ext.extend(function(D){B.superclass.constructor.call(this,D)},tinymce.WindowManager,{alert:function(E,D,F){Ext.MessageBox.alert("",E,function(){D.call(this)},F)},confirm:function(E,D,F){Ext.MessageBox.confirm("",E,function(G){D.call(this,G=="yes")},F)},open:function(D,F){D=D||{};F=F||{};D.width=parseInt(D.width||320);D.height=parseInt(D.height||240)+(tinymce.isIE?8:0);D.min_width=parseInt(D.min_width||150);D.min_height=parseInt(D.min_height||100);D.max_width=parseInt(D.max_width||2000);D.max_height=parseInt(D.max_height||2000);D.movable=D.resizable=true;F.mce_width=D.width;F.mce_height=D.height;F.mce_inline=true;this.features=D;this.params=F;var E=new Ext.Window({title:D.name,width:D.width,height:D.height,minWidth:D.min_width,minHeight:D.min_height,resizable:true,maximizable:D.maximizable==true,minimizable:D.minimizable==true,modal:true,layout:"fit",items:[{xtype:"iframepanel",defaultSrc:D.url||D.file}]});F.mce_window_id=E.getId();E.show(null,function(){if(D.left&&D.top){E.setPagePosition(D.left,D.top)}var G=E.getPosition();D.left=G[0];D.top=G[1];this.onOpen.dispatch(this,D,F)},this);return E},close:function(E,F){if(!F&&E){B.superclass.close.call(this,E);return }var D=Ext.getCmp(F);if(D){this.onClose.dispatch(this);D.close()}},setTitle:function(E,F){var D=Ext.getCmp(F);if(D){D.setTitle(E)}},resizeBy:function(E,G,H){var D=Ext.getCmp(H);if(D){var F=D.getSize();D.setSize(F.width+E,F.height+G)}},focus:function(E){var D=Ext.getCmp(E);if(D){D.setActive(true)}}});var A=Ext.extend(function(F,D,E){this.control=F;A.superclass.constructor.call(this,D,E)},tinymce.ControlManager,{control:null,createDropMenu:function(G,E){var D=A.superclass.createDropMenu.call(this,G,E);var F=D.showMenu;D.showMenu=function(H,J,I){F.call(this,H,J,I);Ext.fly("menu_"+this.id).setStyle("z-index",12000)};return D},createColorSplitButton:function(G,E){var D=A.superclass.createColorSplitButton.call(this,G,E);var F=D.showMenu;D.showMenu=function(H,J,I){F.call(this,H,J,I);Ext.fly(this.id+"_menu").setStyle("z-index",12000)};return D}})}())